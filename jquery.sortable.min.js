/*
 * Based on HTML5 Sortable jQuery Plugin
 * http://farhadi.ir/projects/html5sortable
 * 
 * Original work (c) 2012, Ali Farhadi
 * Released under the MIT license.
 * 
 */
(function(n){var t,r,u,i=n();n.fn.sortable=function(f){var e=String(f);return f=n.extend({connectWith:!1,removeTarget:!1,shims:n()},f),this.each(function(){var l;if(/^enable|disable|destroy$/.test(e)){l=n(this).children(n(this).data("items")).attr("draggable",e==="enable");e==="destroy"&&l.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s");return}var h,a,v,s=n(this).children(f.items),c=n(this).children(f.shims),o=n("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">');s.find(f.handle).mousedown(function(){h=!0}).mouseup(function(){h=!1});n(this).data("items",f.items);i=i.add(o);f.connectWith&&n(f.connectWith).add(this).data("connectWith",f.connectWith);f.removeTarget&&n(f.removeTarget).data("removeTarget",f.removeTarget);s.attr("draggable","true").on("dragstart.h5s",function(i){var o,e;if(f.handle&&!h)return!1;h=!1;o=i.originalEvent.dataTransfer;o.effectAllowed="move";o.setData("text","");a=(t=n(this)).addClass("sortable-dragging").attr("aria-grabbed","true").index();v=t.parent();r=t.outerHeight();u=t.outerWidth();s.parent().trigger("sortstart",{item:t});e=n(f.removeTarget);e.is(":hidden")&&(e.data("sortableRestoreHidden",!0),e.show())}).on("dragend.h5s",function(r,u){var o,e;t&&(u=n.extend({remove:!1},u),o={item:u.remove?null:t,removed:u.remove},n(t).removeClass("sortable-dragging").attr("aria-grabbed","false").show(),i.detach(),u.remove&&t.remove(),a===t.index()&&v.is(t.parent())||s.parent().trigger("sortupdate",o),s.parent().trigger("sortstop",o),e=n(f.removeTarget),e.data("sortableRestoreHidden")&&(u.remove?e.hide({effect:"fade",duration:400}):e.hide(),e.removeData("sortableRestoreHidden")),t=null,n(window).resize())}).add(f.removeTarget).not("a[href], img").on("selectstart.h5s",function(){return this.dragDrop&&this.dragDrop(),!1}).end().add([this,o]).on("dragover.h5s dragenter.h5s drop.h5s",function(e){var h,a,l,p,v,y;if(!s.is(t)&&f.connectWith!==n(t).parent().data("connectWith"))return!0;if(e.type==="drop")return(e.stopPropagation(),f.removeTarget===n(this).data("removeTarget")&&(h=n(t),o.show(),a=jQuery.Event("sortremove"),s.parent().trigger(a,{item:h}),!a.isDefaultPrevented()))?(h.trigger("dragend.h5s",{remove:!0}),h.remove(),n(this).removeClass("sortable-over"),!1):(i.filter(":visible").after(t),t.trigger("dragend.h5s"),!1);if(e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="move",s.is(this)||c.is(this)){if(l=n(this).outerHeight(),p=n(this).outerWidth(),(f.forcePlaceholderSize==="dragged"||f.forcePlaceholderSize===!0)&&(o.height(r),o.width(u)),f.forcePlaceholderSize!=="target"||c.is(this)||(o.height(n(this).height()),o.width(n(this).width())),l+10>r&&((v=l-r,y=n(this).offset().top,o.index()<n(this).index()&&e.originalEvent.pageY<y+v)||o.index()>n(this).index()&&e.originalEvent.pageY>y+l-v))return!1;t.hide();n(this)[o.index()<n(this).index()&&!c.is(this)?"after":"before"](o);i.not(o).detach()}else i.is(this)||n(this).children(f.items).length?f.removeTarget===n(this).data("removeTarget")&&(n(this).addClass("sortable-over"),o.hide()):(i.detach(),n(this).append(o));return!1});n(f.removeTarget).on("dragleave.h5s",function(){n(this).removeClass("sortable-over");o.show()})})}})(jQuery);